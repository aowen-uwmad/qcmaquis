add_definitions (-DBOOST_TEST_DYN_LINK -Wno-unused-variable)

set(VLI_FUZZ_TEST_ITERATIONS "10000" CACHE STRING "Number of fuzz iterations for the fuzz tests") 

set(tests constructors equal negate plus plus_negative gmp_plus minus gmp_minus multiplies multiplies_negative gmp_multiplies_int gmp_multiplies comparison misc_tests )
set(fuzz_tests constructors negate plus plus_negative gmp_plus minus gmp_minus multiplies multiplies_negative gmp_multiplies_int gmp_multiplies)
set(extending_plus_tests gmp_extending_plus)
set(extending_multiplies_test gmp_extending_multiplies gmp_extending_multiplies_negative)

set(test_sizes 2 3 4 5 6 7 8)
set(extending_plus_sizes 2 3 4 5 6)
set(extending_multiplies_sizes 2 3 4)

foreach(test ${tests})
    foreach(size ${test_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${fuzz_tests})
    foreach(size ${test_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)

foreach(test ${extending_plus_tests})
    foreach(size ${extending_plus_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${extending_plus_tests})
    foreach(size ${extending_plus_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)

foreach(test ${extending_multiplies_tests})
    foreach(size ${extending_multiplies_sizes})
        add_executable(${test}_${size}_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size}")
        target_link_libraries(${test}_${size}_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_test ${test}_${size}_test)
    endforeach(size)
endforeach(test)

foreach(test ${extending_multiplies_tests})
    foreach(size ${extending_multiplies_sizes})
        add_executable(${test}_${size}_fuzz_test ${test}.cpp)
        SET_TARGET_PROPERTIES(${test}_${size}_fuzz_test PROPERTIES COMPILE_FLAGS "-DVLI_SIZE=${size} -DVLI_FUZZ_TESTS")
        target_link_libraries(${test}_${size}_fuzz_test ${Boost_LIBRARIES} ${GMP_LIBRARY_CXX} ${PROJECT_BINARY_DIR}/src/vli/libvli_cpu.a ${OpenMP_CXX_FLAGS})
        add_test(${test}_${size}_fuzz_test ${test}_${size}_fuzz_test ${VLI_FUZZ_TEST_ITERATIONS} )
    endforeach(size)
endforeach(test)
